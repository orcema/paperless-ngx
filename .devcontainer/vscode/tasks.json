{
	"version": "2.0.0",
	"tasks": [
        {
            "label": "Start: Frontend Angular",
            "type": "shell",
            "command": "npm start",
            "isBackground": true,
            "options": {
              "cwd": "${workspaceFolder}/src-ui"
            },
            "problemMatcher": [
              {
                "owner": "custom",
                "pattern": [
                  {
                    "regexp": ".",
                    "file": 1,
                    "location": 2,
                    "message": 3
                  }
                ],
                "background": {
                  "activeOnStart": true,
                  "beginsPattern": ".*",
                  "endsPattern": "Compiled successfully"
                }
              }
            ],
            "detail": "triggered also by launch option Chrome: Debug Angular Frontend"
        },
		{
			"label": "Start: Celery Worker",
			"type": "shell",
			"command": "pipenv run celery --app paperless worker -l DEBUG",
			"group": {
				"kind": "build",
				"isDefault": true
			},
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src"
			}
		},
		{
			"label": "Start: Consumer Service (manage.py document_consumer)",
			"type": "shell",
			"command": "pipenv run python manage.py document_consumer",
			"group": "build",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": false,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src"
			}
		},
		{
			"label": "Start: Backend Server (manage.py runserver)",
			"type": "shell",
			"command": "pipenv run python manage.py runserver",
			"group": "build",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": false,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src"
			}
		},
		{
			"label": "Maintenance: manage.py migrate",
			"type": "shell",
			"command": "pipenv run python manage.py migrate",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src"
			}
		},
		{
			"label": "Maintenance: Build Documentation",
			"type": "shell",
			"command": "pipenv run mkdocs build --config-file mkdocs.yml && pipenv run mkdocs serve",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}"
			}
		},
		{
			"label": "Maintenance: manage.py createsuperuser",
			"type": "shell",
			"command": "pipenv run python manage.py createsuperuser",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src"
			}
		},
		{
			"label": "Maintenance: Install Angular CLI",
			"type": "shell",
			"command": "npm ci && ./node_modules/.bin/ng build --configuration production",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src-ui"
			}
		},
		{
			"label": "Maintenance: Compile frontend for production",
			"type": "shell",
			"command": "npm ci && ./node_modules/.bin/ng build --configuration production",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}/src-ui"
			}
		},
		{
			"label": "Maintenance: recreate .venv",
			"type": "shell",
			"command": "rm -R -v .venv/* || pipenv install --dev",
			"group": "none",
			"presentation": {
				"echo": true,
				"reveal": "always",
				"focus": true,
				"panel": "shared",
				"showReuseMessage": false,
				"clear": true,
				"revealProblems": "onProblem"
			},
			"options": {
				"cwd": "${workspaceFolder}"
			}
		},
		{
			"label": "Maintenance: Install Frontend Dependencies",
			"type": "npm",
			"script": "install",
			"path": "src-ui",
			"group": "clean",
			"problemMatcher": [],
			"detail": "install dependencies from package"
		},
		{
			"label": "Project Setup: Run all Init Tasks",
			"dependsOrder": "sequence",
			"dependsOn": [
				"Maintenance: manage.py migrate",
				"Maintenance: manage.py createsuperuser",
				"Maintenance: Compile frontend for production"
			]
		},
		{
			"label": "Project Start: Run all Services",
			"dependsOn": [
				"Start: Celery Worker",
				"Start: Consumer Service (manage.py document_consumer)",
				"Start: Backend Server (manage.py runserver)"
			]
		}
	]
}
